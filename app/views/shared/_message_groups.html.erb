<% groups.each do |msg_group| %>
<div class="row">
  <div class="col-xs-12 col-sm-3">
    <!--受信ページの場合、メンバボックスに表示するのは送信者-->
    <!--送信ページの場合、メンバボックスに表示するのは受信者-->
    <%= render partial: "shared/member_box", locals: {member: Member.find(pageType == 'accept'? msg_group[1] : msg_group[0])} %>
  </div>
  <div class="col-xs-12 col-sm-9">
    <%= link_to (pageType == 'accept'? '返信' : '送信')+'>>', new_message_path(:target => pageType == 'accept'? msg_group[1] : msg_group[0],:pageType => pageType), class: "btn btn-info margin-bottom-10" %>

    <table class="table table-striped table-bordered margin-bottom-10">
      <thead>
        <tr>
          <th>タイトル</th>
          <th><%= pageType == 'accept'? '受信日時' : '送信日時'%></th>
        </tr>
      </thead>
      <tbody>
        <% messages = Message.where(:receiver_id => msg_group[0],:sender_id => msg_group[1]).order(updated_at: :DESC)%>
        <% messages.each.with_index(1) do |msg,index| %>
          <tr>
            <td class="col-sm-9"><%= msg.title %></td>
            <td><%= msg.updated_at.strftime("%Y/%m/%d %H:%M:%S")  %></td>
          </tr>
          <!--最大四件まで表示する-->
          <%break if (messages.length > 5 && index == 4)%>
        <% end %>
      </tbody>
    </table>
    <%if messages.length > 5 %>
      <%= link_to 'もっと見る...', new_message_path(:target => pageType == 'accept'? msg_group[1] : msg_group[0],:pageType => pageType), class: "float-right btn-link" %>
    <%end%>
  </div>
</div>
<% end %>